# Adobe Acquisition Extension for Mobile in iOS

These tracking links can drive users to app stores, app deep links, and interstitials, which can be correlated to in-app behavior. A marketer can create separate links that route users to different platforms, such as iOS, Android, and so on.

You can create, edit, manage, and view reports on trackable mobile app marketing links.

Acquisition links with unique tracking codes can be generated in the Adobe Cloud Platform SDKs. When a user downloads and runs an app from the app store after clicking on the generated link, the SDK automatically collects and sends the acquisition data to Adobe Mobile services.

## Tracking Mobile App Acquisition in iOS

Here is information about how to configure and use Acquisition with the iOS library.

1. Add the Acquisition extension library to your project and implement lifecycle.
2. Import the library: `import "ADBMobileMarketing.h"`.
3. Verify that the ADBMobileConfig.json file contains the required acquisition settings:

   ```objectivec
   {
       "acquisition.server": "c00.adobe.com",
       "acquisition.timeout": 5,
       "acquisition.appid": "714c3a0216700cc3656d6ea6ea69b96d9cfb52c3a5b5fdab42de42d74867588e",
       ...
   }
   ```

   **Important:** If you are sending data to multiple report suites, use the acquisition settings \(acquisition server and appid\) from the app that is associated with the first report suite in your list of report suite IDs.

The acquisition settings are generated by Adobe Mobile services and should not be changed.

**Important:** `acquisition.timeout` must be set to a value higher than 0 to enable app acquisition.

## Tracking Deep Links in iOS

You can use this information to track deep and deferred deep links in your mobile apps by using the Adobe Cloud Platform SDKs.

To track deep links in iOS:

1. Add the SDK to your project and implement Lifecycle metrics.
2. Register the application to handle Inter-App Communications or Support Universal Links.
3. Track deep link in `openURL`.

Here is a sample track deep link:

```objectivec
- (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url { 
    [ACPAcquisition trackAdobeDeepLink:url]; 
    /* 
        Handle deep link 
    */ 
    return YES; 
} 

- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary<NSString *, id> *)options { 
    [ACPAcquisition trackAdobeDeepLink:url]; 
    /* 
        Handle deep link 
    */ 
    return YES; 
}
```

The Mobile SDKs can parse key and value pairs of data appended to any deep or universal link, provided that the link contains a key with a a.deeplink.id label and a corresponding non-null and user generated value. All key and value pairs of data that are appended to the link will be parsed, attached to a lifecycle hit, and sent to Adobe Analytics, provided the link contains the `a.deeplink.id` key and value.

Additionally, you might also choose to append one or more of the following reserved keys \(with user-generated values\) to the deep or universal link:

* a.launch.campaign.trackingcode
* a.launch.campaign.source
* a.launch.campaign.medium
* a.launch.campaign.term
* a.launch.campaign.content

These keys are pre-mapped variables for reporting in Adobe Analytics.

## Tracking Third-Party Deferred Deep Links in iOS

You can use the iOS SDK to implement tracking of third-party deferred deep links.

### Classic Adobe Mobile SDK Deep Linking

The Adobe Mobile SDK currently supports deep linking where the app developer is expected to call the `trackAdobeDeepLink` API and pass the deep linking URL \(fingerprinter URL generated in Adobe Mobile Services during configuration\). The SDK pings the fingerprinter to get acquisition data and appends it to the install/launch analytics calls context data as a part of lifecycle. In addition, it also appends the deeplink data from the deeplink URL parameters.

### Facebook Deep Linking

An ad creator can create an ad on Facebook as a deep link. When users click the ad on Facebook, it goes directly to the information in which they are interested in the app. The deep link, is **not** a fingerprinter URL. However, during ad configuration, there is an option to provide a third-party deep link URL. An app developer who is using the Experience Cloud Mobile SDKs and services is expected to enter the Mobile Services-configured fingerprinter URL in this field. If everything is set up correctly, the Facebook SDK passes this URL to the application when the app is installed or launched.

### Setting up the SDKs in iOS

1. Set up the Facebook SDK:
   * [Getting Started with the Facebook SDK for iOS](https://developers.facebook.com/docs/ios/getting-started)
   * [Deeplinking Set up](https://developers.facebook.com/docs/app-ads/deep-linking#os)
2. Set up the Adobe Mobile SDK:

   Call `trackAdobeDeepLink` and pass the URL to the Mobile SDKs:

   ```objectivec
   - (BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation{
         [ACPAcquisition trackAdobeDeepLink:url];
         return YES;    
   }
   ```

**Tip**: Ensure that the deep link URL has a key with the name `a.deeplink.id`. No URL parameters will be appended to the context data if the URL missed the a.deeplink.id parameter.

If the application is set up as described above, the current Mobile SDK version will append the deep link data to correctly install and/or launch Analytics calls.

### Enable Deep Linking in an iOS Sample Application

1. Register a URL scheme.  
   Ensure that you registered a URL scheme, which is the same as the deep link URL.

   ```markup
   <key>CFBundleURLTypes</key>
   <array>
       <dict>
           <key>CFBundleURLSchemes</key>
           <array>
               <string>sampleapptest</string>
           </array>
       </dict>
   </array>
   ```

2. Link the Facebook SDKs.
3. To edit `AppDelegate`:  
   a. Import the headers.  
   b. Add handle for deferred deep linking.

   ```objectivec
      - (BOOL) application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {

         if (launchOptions[UIApplicationLaunchOptionsURLKey] == nil) {
             if (NSClassFromString(@"FBSDKAppLinkUtility") != nil)
             {
                 [NSClassFromString(@"FBSDKAppLinkUtility")   performSelector:@selector(fetchDeferredAppLink:) withObject:^(NSURL *url, NSError *error) {
                     if (error) {

                         NSLog(@"Received error while fetching deferred app link %@", error);
                     }
                     if (url) {
                         [[UIApplication sharedApplication] openURL:url];
                     }
                 }];
             }
         }
         // add your own logic
         return YES;
     }
   ```

   c. Call `trackAdobeDeepLink` API and pass the deep link URL to the SDKs.

   ```objectivec
      - (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary<NSString *, id> *)options {
         [ACPAcquisition trackAdobeDeepLink:url];
         return YES;
      }
   ```

## Apple Search Ads

The Adobe SDK leverages Apple's Search Ads App Attribution APIs to enable developers and marketers to track and attribute app downloads that originate from Search Ads campaigns in the Apple App Store.

For more information about Search Ad campaigns, see [Apple Search Ads](http://searchads.apple.com/).

### Benefits

Here are some benefits to using Apple ads:

* Easily measure the effectiveness of your Search  Ads app download campaigns by adding a few lines of code to your app.
* Developers can access the date/time of the download and the bidded keyword that drove the conversion.

### Implementing Apple Ads

To enable your app for Search Ad attribution:

1. Implement the Adobe SDK. 
2. Add the iAd framework to the Xcode project file for your app.

### Reporting on Search Ads Attribution

Apple Search Ads attribution data is provided in the acquisition name, the source, and the term values.

If `attribution = true`, all of the `iad-*` fields will be included in the lifecycle hit.

In addition, the following values will be mapped from the `iad` dictionary to our typical acquisition context data fields:

* "iad-campaign-id"--&gt; "a.referrer.campaign.trackingcode"
* "iad-campaign-name"--&gt; "a.referrer.campaign.name"
* "iad-adgroup-id"--&gt; "a.referrer.campaign.content"
* "iad-keyword"--&gt; "a.referrer.campaign.term"

This mapping will make the values available in our standard reporting.

